#!/.runcvm/guest/bin/bash

# runcvm-init forks and execs this script when it receives a SIGTERM

# Load original environment
. /.runcvm/config

poweroff() {
  # Notify the VM's PID 1 to shut down gracefully
  # This triggers the SIGTERM trap we added to firecracker-init.sh
  # We use SIGTERM (15) to PID 1
  echo "Sending SIGTERM to guest PID 1..."
  $RUNCVM_GUEST/scripts/runcvm-ctr-exec 0:0 / 0 0 $RUNCVM_GUEST/bin/busybox kill -15 1 || true
}

poweroff

exit 0
